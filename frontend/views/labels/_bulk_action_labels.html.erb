<html>
  <head>
    <title><%= I18n.t("top_container_labels._frontend.bulk_operations.label_page_title") %></title>
    <link href="<%= "#{AppConfig[:frontend_prefix]}assets/container_labels.css" %>" media="all" rel="stylesheet" type="text/css"/>
    <script src="<%= "#{AppConfig[:frontend_prefix]}assets/jquery.js?body=1" %>" type="text/javascript"></script>
    <script src="<%= "#{AppConfig[:frontend_prefix]}assets/jquery-barcode.min.js" %>" type="text/javascript"></script>
    <script src="<%= "#{AppConfig[:frontend_prefix]}assets/container_labels.js" %>" type="text/javascript"></script>
  </head>

<body>
  <div class="labels">
    <% sorted_labels = [] %>

    <% labels.each do |label| %>
      <% 
        loc = label['container_locations'].select { |cl| cl['status'] == 'current' }.first
        loc = loc ? loc['_resolved'] : {}
                        
        indicator = label['indicator']
        
        barcode = label['barcode'] ? label['barcode'] : ''
        
        resource = label['collection'].empty? ? {} : label['collection'].first

        sorted_labels.push({"loc"=>loc,"indicator"=>indicator,"barcode"=>barcode,"resource"=>resource})
      %>
    <% end %>

    <% sorted_labels.each do |label| %>
      <div class="label <%= params['label_type'] %>">

          <div class="label-resource-id"><%= label['resource']['identifier'] %></div>
          <div class="label-resource-title"><%= label['resource']['display_string'] %></div>

          <div class="label-indicator"><%= label['indicator'] %></div>
          <div class="label-barcode" data="<%= label['barcode'] %>"></div>
  
          <% unless label['loc'].empty? %>
            <div class="label-divider"></div>
            <div class="label-location"><%= label['loc']['title'] rescue '' %></div>
            <div class="label-barcode" data="<%= label['loc']['barcode'] rescue '' %>"></div>
          <% end %>
      </div>
    <% end %>

  </div>
<!--<%
  unless AppConfig[:container_management_labels_pagesize] && AppConfig[:container_management_labels_pagesize][params['label_type']] && AppConfig[:container_management_labels_pagesize][params['label_type']]['size'] && AppConfig[:container_management_labels_pagesize][params['label_type']] && AppConfig[:container_management_labels_pagesize][params['label_type']]['margin']
    params['label_type'] = "default"
  end
 %>-->
<script type="text/javascript">
  var barcodeType = "<%= params['barcode_type'] %>";
</script>
<style type="text/css">
    @page {
      size: <%= AppConfig[:container_management_labels_pagesize][params['label_type']]['size'] rescue AppConfig[:container_management_labels_pagesize]['default']['size'] %>;
      margin: <%= AppConfig[:container_management_labels_pagesize][params['label_type']]['margin']  rescue AppConfig[:container_management_labels_pagesize]['default']['margin']%>;
    }
</style>
</body>
</html>
